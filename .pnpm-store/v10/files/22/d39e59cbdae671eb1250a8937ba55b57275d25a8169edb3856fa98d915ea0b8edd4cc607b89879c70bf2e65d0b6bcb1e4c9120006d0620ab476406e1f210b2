{"version":3,"sources":["../src/clean.ts","../src/read.ts","../src/write.ts"],"sourcesContent":["import fs from 'fs-extra'\n\nexport async function clean(path: string): Promise<void> {\n  return fs.remove(path)\n}\n","import { basename, extname, relative } from 'node:path'\n\nimport fs from 'fs-extra'\nimport { switcher } from 'js-runtime'\n\nfunction slash(path: string, platform: 'windows' | 'mac' | 'linux' = 'linux') {\n  const isWindowsPath = /^\\\\\\\\\\?\\\\/.test(path)\n\n  if (['linux', 'mac'].includes(platform) && !isWindowsPath) {\n    // linux and mac\n    return path.replaceAll(/\\\\/g, '/').replace('../', '').trimEnd()\n  }\n\n  // windows\n  return path.replaceAll(/\\\\/g, '/').replace('../', '').trimEnd()\n}\n\nexport function getRelativePath(rootDir?: string | null, filePath?: string | null, platform: 'windows' | 'mac' | 'linux' = 'linux'): string {\n  if (!rootDir || !filePath) {\n    throw new Error(`Root and file should be filled in when retrieving the relativePath, ${rootDir || ''} ${filePath || ''}`)\n  }\n\n  const relativePath = relative(rootDir, filePath)\n\n  // On Windows, paths are separated with a \"\\\"\n  // However, web browsers use \"/\" no matter the platform\n  const slashedPath = slash(relativePath, platform)\n\n  if (slashedPath.startsWith('../')) {\n    return slashedPath.replace(basename(slashedPath), basename(slashedPath, extname(filePath)))\n  }\n\n  return `./${slashedPath.replace(basename(slashedPath), basename(slashedPath, extname(filePath)))}`\n}\n\nconst reader = switcher(\n  {\n    node: async (path: string) => {\n      return fs.readFile(path, { encoding: 'utf8' })\n    },\n    bun: async (path: string) => {\n      const file = Bun.file(path)\n\n      return file.text()\n    },\n  },\n  'node',\n)\n\nconst syncReader = switcher(\n  {\n    node: (path: string) => {\n      return fs.readFileSync(path, { encoding: 'utf8' })\n    },\n    bun: () => {\n      throw new Error('Bun cannot read sync')\n    },\n  },\n  'node',\n)\n\nexport async function read(path: string): Promise<string> {\n  return reader(path)\n}\n\nexport function readSync(path: string): string {\n  return syncReader(path)\n}\n","import { resolve } from 'node:path'\n\nimport fs from 'fs-extra'\nimport { switcher } from 'js-runtime'\n\ntype Options = { sanity?: boolean }\n\nconst writer = switcher(\n  {\n    node: async (path: string, data: string, { sanity }: Options) => {\n      try {\n        const oldContent = await fs.readFile(resolve(path), {\n          encoding: 'utf-8',\n        })\n        if (oldContent?.toString() === data?.toString()) {\n          return\n        }\n      } catch (_err) {\n        /* empty */\n      }\n\n      await fs.outputFile(resolve(path), data, { encoding: 'utf-8' })\n\n      if (sanity) {\n        const savedData = await fs.readFile(resolve(path), {\n          encoding: 'utf-8',\n        })\n\n        if (savedData?.toString() !== data?.toString()) {\n          throw new Error(`Sanity check failed for ${path}\\n\\nData[${data.length}]:\\n${data}\\n\\nSaved[${savedData.length}]:\\n${savedData}\\n`)\n        }\n\n        return savedData\n      }\n\n      return data\n    },\n    bun: async (path: string, data: string, { sanity }: Options) => {\n      try {\n        await Bun.write(resolve(path), data)\n\n        if (sanity) {\n          const file = Bun.file(resolve(path))\n          const savedData = await file.text()\n\n          if (savedData?.toString() !== data?.toString()) {\n            throw new Error(`Sanity check failed for ${path}\\n\\nData[${path.length}]:\\n${path}\\n\\nSaved[${savedData.length}]:\\n${savedData}\\n`)\n          }\n\n          return savedData\n        }\n\n        return data\n      } catch (e) {\n        console.log(e, resolve(path))\n      }\n    },\n  },\n  'node',\n)\n\nexport async function write(path: string, data: string, options: Options = {}): Promise<string | undefined> {\n  if (data.trim() === '') {\n    return undefined\n  }\n  return writer(path, data.trim(), options)\n}\n"],"mappings":"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","names":["fs","fs","switcher"]}