{"version":3,"sources":["../src/parser/index.ts"],"sourcesContent":["import { bundle, loadConfig } from '@redocly/openapi-core'\nimport OASNormalize from 'oas-normalize'\nimport swagger2openapi from 'swagger2openapi'\n\nimport { Oas } from '../Oas.ts'\nimport { isOpenApiV2Document } from '../utils.ts'\n\nimport type { OASDocument } from 'oas/types'\nimport type { OpenAPI } from 'openapi-types'\n\nexport async function parse(pathOrApi: string | OASDocument, oasClass: typeof Oas = Oas): Promise<Oas> {\n  if (typeof pathOrApi === 'string') {\n    // resolve external refs\n    const config = await loadConfig()\n    const bundleResults = await bundle({ ref: pathOrApi, config, base: pathOrApi })\n\n    return parse(bundleResults.bundle.parsed)\n  }\n\n  const oasNormalize = new OASNormalize(pathOrApi, {\n    enablePaths: true,\n    colorizeErrors: true,\n  })\n  const document = (await oasNormalize.load()) as OpenAPI.Document\n\n  if (isOpenApiV2Document(document)) {\n    const { openapi } = await swagger2openapi.convertObj(document, {\n      anchors: true,\n    })\n\n    return new oasClass({ oas: openapi as OASDocument })\n  }\n\n  return new oasClass({ oas: document as OASDocument })\n}\n"],"mappings":";;;;;;AAAA,SAAS,QAAQ,kBAAkB;AACnC,OAAO,kBAAkB;AACzB,OAAO,qBAAqB;AAQ5B,eAAsB,MAAM,WAAiC,WAAuB,KAAmB;AACrG,MAAI,OAAO,cAAc,UAAU;AAEjC,UAAM,SAAS,MAAM,WAAW;AAChC,UAAM,gBAAgB,MAAM,OAAO,EAAE,KAAK,WAAW,QAAQ,MAAM,UAAU,CAAC;AAE9E,WAAO,MAAM,cAAc,OAAO,MAAM;AAAA,EAC1C;AAEA,QAAM,eAAe,IAAI,aAAa,WAAW;AAAA,IAC/C,aAAa;AAAA,IACb,gBAAgB;AAAA,EAClB,CAAC;AACD,QAAM,WAAY,MAAM,aAAa,KAAK;AAE1C,MAAI,oBAAoB,QAAQ,GAAG;AACjC,UAAM,EAAE,QAAQ,IAAI,MAAM,gBAAgB,WAAW,UAAU;AAAA,MAC7D,SAAS;AAAA,IACX,CAAC;AAED,WAAO,IAAI,SAAS,EAAE,KAAK,QAAuB,CAAC;AAAA,EACrD;AAEA,SAAO,IAAI,SAAS,EAAE,KAAK,SAAwB,CAAC;AACtD;","names":[]}