{"version":3,"sources":["/home/runner/work/kubb/kubb/packages/oas/dist/chunk-ATRCKZ2K.cjs","../src/utils.ts","../src/Oas.ts"],"names":["schema"],"mappings":"AAAA,qxBAAI,YAAY,EAAE,CAAC,GAAG,EAAE,GAAG;AAC3B,EAAE,MAAM,SAAS,CAAC,GAAG,CAAC;AACtB,CAAC;AACD,IAAI,cAAc,EAAE,CAAC,GAAG,EAAE,MAAM,EAAE,GAAG,EAAE,GAAG,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,WAAW,CAAC,UAAU,EAAE,GAAG,CAAC;AACzF,IAAI,aAAa,EAAE,CAAC,GAAG,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,CAAC,aAAa,CAAC,GAAG,EAAE,MAAM,EAAE,yBAAyB,CAAC,EAAE,OAAO,EAAE,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,EAAE,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;AAChJ,IAAI,aAAa,EAAE,CAAC,GAAG,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,EAAE,WAAW,CAAC,mDAAmD,EAAE,EAAE,OAAO,WAAW,QAAQ,EAAE,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,EAAE,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,KAAK,CAAC;AACpM,IAAI,aAAa,EAAE,CAAC,GAAG,EAAE,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG,CAAC,aAAa,CAAC,GAAG,EAAE,MAAM,EAAE,wBAAwB,CAAC,EAAE,OAAO,EAAE,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,KAAK,EAAE,EAAE,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC;AAC3K,IAAI,gBAAgB,EAAE,CAAC,GAAG,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,CAAC,aAAa,CAAC,GAAG,EAAE,MAAM,EAAE,uBAAuB,CAAC,EAAE,MAAM,CAAC;AAC5G;AACA;ACTA,kCAAgC;AAChC,gCAA8B;AAKvB,SAAS,mBAAA,CAAoB,GAAA,EAAqC;AACvE,EAAA,OAAO,IAAA,GAAO,mCAAA,GAAiB,EAAA,GAAK,CAAA,CAAE,UAAA,GAAa,GAAA,CAAA;AACrD;AAKO,SAAS,qBAAA,CAAsB,GAAA,EAAuC;AAC3E,EAAA,OAAO,IAAA,GAAO,mCAAA,GAAuC,EAAA,GAAK,UAAA,GAAa,IAAA,GAAO,GAAA,CAAI,OAAA,CAAQ,UAAA,CAAW,KAAK,CAAA;AAC5G;AAMO,SAAS,iBAAA,CAAkB,GAAA,EAA6D;AAC7F,EAAA,OAAO,IAAA,GAAO,KAAA,GAAQ,GAAA;AACxB;AAEO,SAAS,WAAA,CAAY,GAAA,EAA+E;AACzG,EAAA,OAAO,CAAC,CAAC,IAAA,GAAO,0BAAA,GAAS,CAAA;AAC3B;AAEO,SAAS,UAAA,CAAW,MAAA,EAAgC;AACzD,EAAA,GAAA,CAAI,CAAC,MAAA,EAAQ;AACX,IAAA,OAAO,KAAA;AAAA,EACT;AAEA,EAAA,OAAO,KAAA,CAAM,OAAA,CAAQ,MAAA,CAAO,QAAQ,EAAA,EAAI,CAAC,iBAAC,MAAA,mBAAO,QAAA,6BAAU,SAAA,EAAS,CAAC,CAAC,MAAA,CAAO,QAAA;AAC/E;AAEO,SAAS,UAAA,CAAW,MAAA,EAAgC;AACzD,EAAA,OAAO,CAAC,UAAA,CAAW,MAAM,CAAA;AAC3B;ADNA;AACA;AElCA,oEAAoB;AACpB,yGAAyB;AACzB,kCAAgC;AAEhC,oGAAwB;AAJxB,IAAA,QAAA,EAAA,cAAA,EAAA,yBAAA;AAiBO,IAAM,IAAA,EAAN,MAAA,QAAwC,cAAQ;AAAA,EAIrD,WAAA,CAAY,EAAE,GAAA,EAAK,KAAK,CAAA,EAAsD,QAAA,EAAmB,CAAC,CAAA,EAAG;AACnG,IAAA,GAAA,CAAI,OAAO,IAAA,IAAQ,QAAA,EAAU;AAC3B,MAAA,IAAA,EAAM,IAAA,CAAK,KAAA,CAAM,GAAG,CAAA;AAAA,IACtB;AAEA,IAAA,KAAA,CAAM,GAAA,EAAoB,IAAI,CAAA;AAT3B,IAAA,YAAA,CAAA,IAAA,EAAA,cAAA,CAAA;AACL,IAAA,YAAA,CAAA,IAAA,EAAA,QAAA,EAAoB,CAAC,CAAA,CAAA;AACrB,IAAA,IAAA,CAAA,SAAA,EAAiB,KAAA,CAAA;AASf,IAAA,IAAA,CAAK,SAAA,EAAW,GAAA;AAChB,IAAA,YAAA,CAAA,IAAA,EAAK,QAAA,EAAW,OAAA,CAAA;AAAA,EAClB;AAAA,EAEA,GAAA,CAAI,IAAA,EAAc;AAChB,IAAA,MAAM,QAAA,EAAU,IAAA;AAChB,IAAA,KAAA,EAAO,IAAA,CAAK,IAAA,CAAK,CAAA;AACjB,IAAA,GAAA,CAAI,KAAA,IAAS,EAAA,EAAI;AACf,MAAA,OAAO,KAAA;AAAA,IACT;AACA,IAAA,GAAA,CAAI,IAAA,CAAK,UAAA,CAAW,GAAG,CAAA,EAAG;AACxB,MAAA,KAAA,EAAO,UAAA,CAAW,kBAAA,CAAmB,IAAA,CAAK,SAAA,CAAU,CAAC,CAAC,CAAA;AAAA,IACxD,EAAA,KAAO;AACL,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,gCAAA,EAAmC,OAAO,CAAA,CAAA,CAAG,CAAA;AAAA,IAC/D;AACA,IAAA,MAAM,QAAA,EAAU,qBAAA,CAAY,GAAA,CAAI,IAAA,CAAK,GAAA,EAAK,IAAI,CAAA;AAE9C,IAAA,GAAA,CAAI,CAAC,OAAA,EAAS;AACZ,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,gCAAA,EAAmC,OAAO,CAAA,CAAA,CAAG,CAAA;AAAA,IAC/D;AACA,IAAA,OAAO,OAAA;AAAA,EACT;AAAA,EAEA,GAAA,CAAI,IAAA,EAAc,KAAA,EAAgB;AAChC,IAAA,MAAM,QAAA,EAAU,IAAA;AAChB,IAAA,KAAA,EAAO,IAAA,CAAK,IAAA,CAAK,CAAA;AACjB,IAAA,GAAA,CAAI,KAAA,IAAS,EAAA,EAAI;AACf,MAAA,OAAO,KAAA;AAAA,IACT;AACA,IAAA,GAAA,CAAI,IAAA,CAAK,UAAA,CAAW,GAAG,CAAA,EAAG;AACxB,MAAA,KAAA,EAAO,UAAA,CAAW,kBAAA,CAAmB,IAAA,CAAK,SAAA,CAAU,CAAC,CAAC,CAAA;AAAA,IACxD,EAAA,KAAO;AACL,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,gCAAA,EAAmC,OAAO,CAAA,CAAA,CAAG,CAAA;AAAA,IAC/D;AAEA,IAAA,qBAAA,CAAY,GAAA,CAAI,IAAA,CAAK,GAAA,EAAK,IAAA,EAAM,KAAK,CAAA;AAAA,EACvC;AAAA,EAEA,qBAAA,CAAA,EAA8B;AAC5B,IAAA,MAAM,QAAA,kBAAW,IAAA,qBAAK,GAAA,qBAAI,UAAA,6BAAY,UAAA,GAAW,CAAC,CAAA;AAElD,IAAA,MAAA,CAAO,OAAA,CAAQ,OAAO,CAAA,CAAE,OAAA,CAAQ,CAAC,CAAC,GAAA,EAAK,YAAY,CAAA,EAAA,GAAM;AACvD,MAAA,GAAA,CAAI,gBAAA,GAAmB,YAAA,EAAc;AACnC,QAAA,MAAM,EAAE,QAAA,EAAU,CAAC,CAAA,EAAG,aAAa,EAAA,EAAK,YAAA,CAAa,cAAA,GAAiB,CAAC,CAAA;AAEvE,QAAA,MAAA,CAAO,OAAA,CAAQ,OAAO,CAAA,CAAE,OAAA,CAAQ,CAAC,CAAC,UAAA,EAAY,YAAY,CAAA,EAAA,GAAM;AAC9D,UAAA,GAAA,CAAI,YAAA,EAAc;AAChB,YAAA,MAAM,YAAA,EAAc,IAAA,CAAK,GAAA,CAAI,YAAY,CAAA;AACzC,YAAA,MAAM,SAAA,kBAAW,WAAA,qBAAY,UAAA,4BAAA,CAAa,YAAY,GAAA;AAEtD,YAAA,GAAA,CAAI,QAAA,EAAU;AACZ,cAAA,WAAA,CAAY,UAAA,CAAW,YAAY,EAAA,EAAI;AAAA,gBACrC,GAAG,WAAA,CAAY,UAAA,CAAW,YAAY,CAAA;AAAA,gBACtC,IAAA,EAAM,CAAC,oCAAI,QAAA,6BAAU,IAAA,6BAAM,MAAA,qBAAO,CAAC,KAAA,EAAA,GAAU,MAAA,IAAU,UAAU,GAAA,UAAK,CAAC,GAAA,EAAI,UAAU;AAAA,cACvF,CAAA;AAEA,cAAA,WAAA,CAAY,SAAA,EAAW,CAAC,oBAAI,WAAA,CAAY,QAAA,UAAY,CAAC,GAAA,EAAI,YAAY,CAAA;AAErE,cAAA,IAAA,CAAK,GAAA,CAAI,YAAA,EAAc,WAAW,CAAA;AAAA,YACpC;AAAA,UACF;AAAA,QACF,CAAC,CAAA;AAAA,MACH;AAAA,IACF,CAAC,CAAA;AAAA,EACH;AAAA,EAEA,kBAAA,CAAmB,MAAA,EAAkB;AACnC,IAAA,GAAA,CAAI,WAAA,CAAY,MAAM,CAAA,EAAG;AACvB,MAAA,OAAO;AAAA,QACL,GAAG,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,IAAI,CAAA;AAAA,QACvB,IAAA,EAAM,MAAA,CAAO;AAAA,MACf,CAAA;AAAA,IACF;AAEA,IAAA,OAAO,MAAA;AAAA,EACT;AAAA,EA2DA,iBAAA,CAAkB,SAAA,EAAsB,UAAA,EAA2C;AACjF,IAAA,GAAA,CAAI,SAAA,CAAU,MAAA,CAAO,SAAA,EAAW;AAC9B,MAAA,MAAA,CAAO,IAAA,CAAK,SAAA,CAAU,MAAA,CAAO,SAAS,CAAA,CAAE,OAAA,CAAQ,CAAC,GAAA,EAAA,GAAQ;AACvD,QAAA,MAAMA,QAAAA,EAAS,SAAA,CAAU,MAAA,CAAO,SAAA,CAAW,GAAG,CAAA;AAC9C,QAAA,MAAM,KAAA,EAAO,WAAA,CAAYA,OAAM,EAAA,EAAIA,OAAAA,CAAO,KAAA,EAAO,KAAA,CAAA;AAEjD,QAAA,GAAA,CAAIA,QAAAA,GAAU,IAAA,EAAM;AAClB,UAAA,SAAA,CAAU,MAAA,CAAO,SAAA,CAAW,GAAG,EAAA,EAAI,IAAA,CAAK,GAAA,CAAI,IAAI,CAAA;AAAA,QAClD;AAAA,MACF,CAAC,CAAA;AAAA,IACH;AAEA,IAAA,MAAM,gBAAA,EAAkB,eAAA,CAAA,IAAA,EAAK,cAAA,EAAA,yBAAA,CAAA,CAAL,IAAA,CAAA,IAAA,EAA6B,SAAA,CAAU,uBAAA,CAAwB,UAAU,CAAA,CAAA;AAEjG,IAAA,MAAM,EAAE,YAAY,EAAA,EAAI,YAAA,CAAA,IAAA,EAAK,QAAA,CAAA;AAC7B,IAAA,MAAM,aAAA,EAAe,eAAA,CAAgB,WAAW,CAAA;AAEhD,IAAA,GAAA,CAAI,aAAA,IAAiB,KAAA,EAAO;AAE1B,MAAA,OAAO,CAAC,CAAA;AAAA,IACV;AAEA,IAAA,MAAM,OAAA,EAAS,KAAA,CAAM,OAAA,CAAQ,YAAY,EAAA,EAAI,YAAA,CAAa,CAAC,CAAA,CAAE,OAAA,EAAS,YAAA,CAAa,MAAA;AAEnF,IAAA,GAAA,CAAI,CAAC,MAAA,EAAQ;AAGX,MAAA,OAAO,CAAC,CAAA;AAAA,IACV;AAEA,IAAA,OAAO,IAAA,CAAK,kBAAA,CAAmB,MAAM,CAAA;AAAA,EACvC;AAAA,EAEA,gBAAA,CAAiB,SAAA,EAAgD;AAC/D,IAAA,MAAM,EAAE,YAAY,EAAA,EAAI,YAAA,CAAA,IAAA,EAAK,QAAA,CAAA;AAE7B,IAAA,GAAA,CAAI,SAAA,CAAU,MAAA,CAAO,WAAA,EAAa;AAChC,MAAA,SAAA,CAAU,MAAA,CAAO,YAAA,EAAc,IAAA,CAAK,kBAAA,CAAmB,SAAA,CAAU,MAAA,CAAO,WAAW,CAAA;AAAA,IACrF;AAEA,IAAA,MAAM,YAAA,EAAc,SAAA,CAAU,cAAA,CAAe,WAAW,CAAA;AAExD,IAAA,GAAA,CAAI,YAAA,IAAgB,KAAA,EAAO;AACzB,MAAA,OAAO,KAAA,CAAA;AAAA,IACT;AAEA,IAAA,MAAM,OAAA,EAAS,KAAA,CAAM,OAAA,CAAQ,WAAW,EAAA,EAAI,WAAA,CAAY,CAAC,CAAA,CAAE,OAAA,EAAS,WAAA,CAAY,MAAA;AAEhF,IAAA,GAAA,CAAI,CAAC,MAAA,EAAQ;AACX,MAAA,OAAO,KAAA,CAAA;AAAA,IACT;AAEA,IAAA,OAAO,IAAA,CAAK,kBAAA,CAAmB,MAAM,CAAA;AAAA,EACvC;AAAA,EAEA,mBAAA,CAAoB,SAAA,EAAsB,KAAA,EAAyD;AACjG,IAAA,MAAM,EAAE,YAAA,EAAc,SAAA,CAAU,cAAA,CAAe,EAAE,EAAA,EAAI,YAAA,CAAA,IAAA,EAAK,QAAA,CAAA;AAC1D,IAAA,MAAM,OAAA,EAAS,SAAA,CACZ,aAAA,CAAc,CAAA,CACd,GAAA,CAAI,CAAC,MAAA,EAAA,GAAW;AACf,MAAA,OAAO,IAAA,CAAK,kBAAA,CAAmB,MAAM,CAAA;AAAA,IACvC,CAAC,CAAA,CACA,MAAA,CAAO,CAAC,CAAA,EAAA,GAAM,CAAA,CAAE,GAAA,IAAO,KAAK,CAAA;AAE/B,IAAA,GAAA,CAAI,CAAC,MAAA,CAAO,MAAA,EAAQ;AAClB,MAAA,OAAO,IAAA;AAAA,IACT;AAEA,IAAA,OAAO,MAAA,CAAO,MAAA;AAAA,MACZ,CAAC,MAAA,EAAQ,cAAA,EAAA,GAAmB;AAC1B,QAAA,MAAM,SAAA,mCAAW,cAAA,uBAAe,OAAA,8BAAA,CAAU,WAAW,CAAA,+BAAG,QAAA,UAAW,cAAA,CAAe,QAAA;AAClF,QAAA,MAAM,SAAA,EAAW,CAAC,GAAI,MAAA,CAAO,SAAA,GAAa,CAAC,CAAA,EAAY,cAAA,CAAe,SAAA,EAAW,cAAA,CAAe,KAAA,EAAO,KAAA,CAAS,CAAA,CAAE,MAAA,CAAO,OAAO,CAAA;AAEhI,QAAA,OAAO;AAAA,UACL,GAAG,MAAA;AAAA,UACH,WAAA,EAAa,MAAA,CAAO,WAAA;AAAA,UACpB,UAAA,EAAY,MAAA,CAAO,UAAA;AAAA,UACnB,OAAA,EAAS,MAAA,CAAO,OAAA;AAAA,UAChB,QAAA;AAAA,UACA,UAAA,EAAY;AAAA,YACV,GAAG,MAAA,CAAO,UAAA;AAAA,YACV,CAAC,cAAA,CAAe,IAAI,CAAA,EAAG;AAAA,cACrB,WAAA,EAAa,cAAA,CAAe,WAAA;AAAA,cAC5B,GAAG;AAAA,YACL;AAAA,UACF;AAAA,QACF,CAAA;AAAA,MACF,CAAA;AAAA,MACA,EAAE,IAAA,EAAM,QAAA,EAAU,QAAA,EAAU,CAAC,CAAA,EAAG,UAAA,EAAY,CAAC,EAAE;AAAA,IACjD,CAAA;AAAA,EACF;AAAA,EAEA,MAAM,QAAA,CAAA,EAAW;AACf,IAAA,MAAM,aAAA,EAAe,IAAI,2BAAA,CAAa,IAAA,CAAK,GAAA,EAAK;AAAA,MAC9C,WAAA,EAAa,IAAA;AAAA,MACb,cAAA,EAAgB;AAAA,IAClB,CAAC,CAAA;AAED,IAAA,MAAM,YAAA,CAAa,QAAA,CAAS;AAAA,MAC1B,MAAA,EAAQ;AAAA,QACN,QAAA,EAAU;AAAA,UACR,cAAA,EAAgB,IAAA;AAAA,UAChB,MAAA,EAAQ,KAAA;AAAA,UACR,IAAA,EAAM;AAAA,QACR;AAAA,MACF;AAAA,IACF,CAAC,CAAA;AAAA,EACH;AACF,CAAA;AA5PE,SAAA,EAAA,IAAA,OAAA,CAAA,CAAA;AADK,eAAA,EAAA,IAAA,OAAA,CAAA,CAAA;AAAA;AAAA;AAAA;AA2FL,0BAAA,EAAuB,QAAA,CAAC,YAAA,EAAoI;AAC1J,EAAA,SAAS,eAAA,CAAgB,IAAA,EAAM,YAAA,EAAqC;AAClE,IAAA,OAAO,CAAC,CAAC,GAAA;AAAA,EACX;AAEA,EAAA,OAAO,CAAC,WAAA,EAAA,GAAgB;AACtB,IAAA,GAAA,CAAI,CAAC,eAAA,CAAgB,YAAY,CAAA,EAAG;AAClC,MAAA,OAAO,KAAA;AAAA,IACT;AAEA,IAAA,GAAA,CAAI,WAAA,CAAY,YAAY,CAAA,EAAG;AAG7B,MAAA,OAAO,KAAA;AAAA,IACT;AAEA,IAAA,GAAA,CAAI,CAAC,YAAA,CAAa,OAAA,EAAS;AACzB,MAAA,OAAO,KAAA;AAAA,IACT;AAEA,IAAA,GAAA,CAAI,WAAA,EAAa;AACf,MAAA,GAAA,CAAI,CAAA,CAAE,YAAA,GAAe,YAAA,CAAa,OAAA,CAAA,EAAU;AAC1C,QAAA,OAAO,KAAA;AAAA,MACT;AAEA,MAAA,OAAO,YAAA,CAAa,OAAA,CAAQ,WAAW,CAAA;AAAA,IACzC;AAIA,IAAA,IAAI,qBAAA,EAA2C,KAAA,CAAA;AAC/C,IAAA,MAAM,aAAA,EAAe,MAAA,CAAO,IAAA,CAAK,YAAA,CAAa,OAAO,CAAA;AACrD,IAAA,YAAA,CAAa,OAAA,CAAQ,CAAC,EAAA,EAAA,GAAe;AACnC,MAAA,GAAA,CAAI,CAAC,qBAAA,GAAwB,sBAAA,CAAgB,IAAA,CAAK,EAAE,CAAA,EAAG;AACrD,QAAA,qBAAA,EAAuB,EAAA;AAAA,MACzB;AAAA,IACF,CAAC,CAAA;AAED,IAAA,GAAA,CAAI,CAAC,oBAAA,EAAsB;AACzB,MAAA,YAAA,CAAa,OAAA,CAAQ,CAAC,EAAA,EAAA,GAAe;AACnC,QAAA,GAAA,CAAI,CAAC,oBAAA,EAAsB;AACzB,UAAA,qBAAA,EAAuB,EAAA;AAAA,QACzB;AAAA,MACF,CAAC,CAAA;AAAA,IACH;AAEA,IAAA,GAAA,CAAI,oBAAA,EAAsB;AACxB,MAAA,OAAO,CAAC,oBAAA,EAAsB,YAAA,CAAa,OAAA,CAAQ,oBAAoB,CAAA,EAAI,GAAI,YAAA,CAAa,YAAA,EAAc,CAAC,YAAA,CAAa,WAAW,EAAA,EAAI,CAAC,CAAE,CAAA;AAAA,IAC5I;AAEA,IAAA,OAAO,KAAA;AAAA,EACT,CAAA;AACF,CAAA;AFiFF;AACA;AACE;AACA;AACA;AACA;AACA;AACA;AACA;AACF,gRAAC","file":"/home/runner/work/kubb/kubb/packages/oas/dist/chunk-ATRCKZ2K.cjs","sourcesContent":[null,"import { isRef, isSchema } from 'oas/types'\nimport { isPlainObject } from 'remeda'\n\nimport type { ParameterObject, SchemaObject } from 'oas/types'\nimport type { OpenAPIV2, OpenAPIV3, OpenAPIV3_1 } from 'openapi-types'\n\nexport function isOpenApiV2Document(doc: any): doc is OpenAPIV2.Document {\n  return doc && isPlainObject(doc) && !('openapi' in doc)\n}\nexport function isOpenApiV3Document(doc: any): doc is OpenAPIV3.Document {\n  return doc && isPlainObject(doc) && 'openapi' in doc\n}\n\nexport function isOpenApiV3_1Document(doc: any): doc is OpenAPIV3_1.Document {\n  return doc && isPlainObject<OpenAPIV3_1.Document>(doc) && 'openapi' in doc && doc.openapi.startsWith('3.1')\n}\n\nexport function isJSONSchema(obj?: unknown): obj is SchemaObject {\n  return !!obj && isSchema(obj)\n}\n\nexport function isParameterObject(obj: ParameterObject | SchemaObject): obj is ParameterObject {\n  return obj && 'in' in obj\n}\n\nexport function isReference(obj?: unknown): obj is OpenAPIV3.ReferenceObject | OpenAPIV3_1.ReferenceObject {\n  return !!obj && isRef(obj)\n}\n\nexport function isRequired(schema?: SchemaObject): boolean {\n  if (!schema) {\n    return false\n  }\n\n  return Array.isArray(schema.required) ? !!schema.required?.length : !!schema.required\n}\n\nexport function isOptional(schema?: SchemaObject): boolean {\n  return !isRequired(schema)\n}\n","import BaseOas from 'oas'\nimport OASNormalize from 'oas-normalize'\nimport { matchesMimeType } from 'oas/utils'\n\nimport jsonpointer from 'jsonpointer'\n\nimport { isReference } from './utils.ts'\n\nimport type { Operation } from 'oas/operation'\nimport type { MediaTypeObject, OASDocument, ResponseObject, SchemaObject, User } from 'oas/types'\nimport type { OasTypes, OpenAPIV3 } from './index.ts'\nimport type { contentType } from './types.ts'\n\ntype Options = {\n  contentType?: contentType\n}\n\nexport class Oas<const TOAS = unknown> extends BaseOas {\n  #options: Options = {}\n  document: TOAS = undefined as unknown as TOAS\n\n  constructor({ oas, user }: { oas: TOAS | OASDocument | string; user?: User }, options: Options = {}) {\n    if (typeof oas === 'string') {\n      oas = JSON.parse(oas)\n    }\n\n    super(oas as OASDocument, user)\n\n    this.document = oas as TOAS\n    this.#options = options\n  }\n\n  get($ref: string) {\n    const origRef = $ref\n    $ref = $ref.trim()\n    if ($ref === '') {\n      return false\n    }\n    if ($ref.startsWith('#')) {\n      $ref = globalThis.decodeURIComponent($ref.substring(1))\n    } else {\n      throw new Error(`Could not find a definition for ${origRef}.`)\n    }\n    const current = jsonpointer.get(this.api, $ref)\n\n    if (!current) {\n      throw new Error(`Could not find a definition for ${origRef}.`)\n    }\n    return current\n  }\n\n  set($ref: string, value: unknown) {\n    const origRef = $ref\n    $ref = $ref.trim()\n    if ($ref === '') {\n      return false\n    }\n    if ($ref.startsWith('#')) {\n      $ref = globalThis.decodeURIComponent($ref.substring(1))\n    } else {\n      throw new Error(`Could not find a definition for ${origRef}.`)\n    }\n\n    jsonpointer.set(this.api, $ref, value)\n  }\n\n  resolveDiscriminators(): void {\n    const schemas = (this.api.components?.schemas || {}) as Record<string, OasTypes.SchemaObject>\n\n    Object.entries(schemas).forEach(([key, schemaObject]) => {\n      if ('discriminator' in schemaObject) {\n        const { mapping = {}, propertyName } = (schemaObject.discriminator || {}) as OpenAPIV3.DiscriminatorObject\n\n        Object.entries(mapping).forEach(([mappingKey, mappingValue]) => {\n          if (mappingValue) {\n            const childSchema = this.get(mappingValue)\n            const property = childSchema.properties?.[propertyName] as SchemaObject\n\n            if (property) {\n              childSchema.properties[propertyName] = {\n                ...childSchema.properties[propertyName],\n                enum: [...(property?.enum?.filter((value) => value !== mappingKey) ?? []), mappingKey],\n              }\n\n              childSchema.required = [...(childSchema.required ?? []), propertyName]\n\n              this.set(mappingValue, childSchema)\n            }\n          }\n        })\n      }\n    })\n  }\n\n  dereferenceWithRef(schema?: unknown) {\n    if (isReference(schema)) {\n      return {\n        ...this.get(schema.$ref),\n        $ref: schema.$ref,\n      }\n    }\n\n    return schema\n  }\n\n  /**\n   * Oas does not have a getResponseBody(contentType)\n   */\n  #getResponseBodyFactory(responseBody: boolean | ResponseObject): (contentType?: string) => MediaTypeObject | false | [string, MediaTypeObject, ...string[]] {\n    function hasResponseBody(res = responseBody): res is ResponseObject {\n      return !!res\n    }\n\n    return (contentType) => {\n      if (!hasResponseBody(responseBody)) {\n        return false\n      }\n\n      if (isReference(responseBody)) {\n        // If the request body is still a `$ref` pointer we should return false because this library\n        // assumes that you've run dereferencing beforehand.\n        return false\n      }\n\n      if (!responseBody.content) {\n        return false\n      }\n\n      if (contentType) {\n        if (!(contentType in responseBody.content)) {\n          return false\n        }\n\n        return responseBody.content[contentType]!\n      }\n\n      // Since no media type was supplied we need to find either the first JSON-like media type that\n      // we've got, or the first available of anything else if no JSON-like media types are present.\n      let availablecontentType: string | undefined = undefined\n      const contentTypes = Object.keys(responseBody.content)\n      contentTypes.forEach((mt: string) => {\n        if (!availablecontentType && matchesMimeType.json(mt)) {\n          availablecontentType = mt\n        }\n      })\n\n      if (!availablecontentType) {\n        contentTypes.forEach((mt: string) => {\n          if (!availablecontentType) {\n            availablecontentType = mt\n          }\n        })\n      }\n\n      if (availablecontentType) {\n        return [availablecontentType, responseBody.content[availablecontentType]!, ...(responseBody.description ? [responseBody.description] : [])]\n      }\n\n      return false\n    }\n  }\n\n  getResponseSchema(operation: Operation, statusCode: string | number): SchemaObject {\n    if (operation.schema.responses) {\n      Object.keys(operation.schema.responses).forEach((key) => {\n        const schema = operation.schema.responses![key]\n        const $ref = isReference(schema) ? schema.$ref : undefined\n\n        if (schema && $ref) {\n          operation.schema.responses![key] = this.get($ref)\n        }\n      })\n    }\n\n    const getResponseBody = this.#getResponseBodyFactory(operation.getResponseByStatusCode(statusCode))\n\n    const { contentType } = this.#options\n    const responseBody = getResponseBody(contentType)\n\n    if (responseBody === false) {\n      // return empty object because response will always be defined(request does not need a body)\n      return {}\n    }\n\n    const schema = Array.isArray(responseBody) ? responseBody[1].schema : responseBody.schema\n\n    if (!schema) {\n      // return empty object because response will always be defined(request does not need a body)\n\n      return {}\n    }\n\n    return this.dereferenceWithRef(schema)\n  }\n\n  getRequestSchema(operation: Operation): SchemaObject | undefined {\n    const { contentType } = this.#options\n\n    if (operation.schema.requestBody) {\n      operation.schema.requestBody = this.dereferenceWithRef(operation.schema.requestBody)\n    }\n\n    const requestBody = operation.getRequestBody(contentType)\n\n    if (requestBody === false) {\n      return undefined\n    }\n\n    const schema = Array.isArray(requestBody) ? requestBody[1].schema : requestBody.schema\n\n    if (!schema) {\n      return undefined\n    }\n\n    return this.dereferenceWithRef(schema)\n  }\n\n  getParametersSchema(operation: Operation, inKey: 'path' | 'query' | 'header'): SchemaObject | null {\n    const { contentType = operation.getContentType() } = this.#options\n    const params = operation\n      .getParameters()\n      .map((schema) => {\n        return this.dereferenceWithRef(schema)\n      })\n      .filter((v) => v.in === inKey)\n\n    if (!params.length) {\n      return null\n    }\n\n    return params.reduce(\n      (schema, pathParameters) => {\n        const property = pathParameters.content?.[contentType]?.schema ?? (pathParameters.schema as SchemaObject)\n        const required = [...(schema.required || ([] as any)), pathParameters.required ? pathParameters.name : undefined].filter(Boolean)\n\n        return {\n          ...schema,\n          description: schema.description,\n          deprecated: schema.deprecated,\n          example: schema.example,\n          required,\n          properties: {\n            ...schema.properties,\n            [pathParameters.name]: {\n              description: pathParameters.description,\n              ...property,\n            },\n          },\n        }\n      },\n      { type: 'object', required: [], properties: {} } as SchemaObject,\n    )\n  }\n\n  async valdiate() {\n    const oasNormalize = new OASNormalize(this.api, {\n      enablePaths: true,\n      colorizeErrors: true,\n    })\n\n    await oasNormalize.validate({\n      parser: {\n        validate: {\n          colorizeErrors: true,\n          schema: false,\n          spec: false,\n        },\n      },\n    })\n  }\n}\n"]}